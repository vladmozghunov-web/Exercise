using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
public static class CryptoSquare
{
    public static string NormalizedPlaintext(string plaintext)
    {
        string clean = "";
        foreach (char c in plaintext.ToLower())
        {
            if (char.IsLetterOrDigit(c))
            {
                clean += c;
            }
        }
        return clean;
    }
    public static IEnumerable<string> PlaintextSegments(string plaintext)
    {
        string normalized = NormalizedPlaintext(plaintext);
        if (normalized.Length == 0)
            return new List<string>();
        int c = (int)Math.Ceiling(Math.Sqrt(normalized.Length));
        List<string> result = new List<string>();
        for (int i = 0; i < normalized.Length; i += c)
        {
            if (i + c <= normalized.Length)
                result.Add(normalized.Substring(i, c));
            else
                result.Add(normalized.Substring(i));
        }
        return result;
    }
    public static string Encoded(string plaintext)
    {
        var segments = PlaintextSegments(plaintext).ToList();
        if (segments.Count == 0)
            return "";
        int c = segments[0].Length;
        int r = segments.Count;
        StringBuilder encoded = new StringBuilder();
        for (int i = 0; i < c; i++)
        {
            for (int j = 0; j < r; j++)
            {
                if (i < segments[j].Length)
                    encoded.Append(segments[j][i]);
            }
        }
        return encoded.ToString();
    }
    public static string Ciphertext(string plaintext)
    {
        var segments = PlaintextSegments(plaintext).ToList();
        if (segments.Count == 0)
            return "";
        int c = segments[0].Length;
        int r = segments.Count;
        List<string> words = new List<string>();
        for (int i = 0; i < c; i++)
        {
            string word = "";
            for (int j = 0; j < r; j++)
            {
                if (i < segments[j].Length)
                    word += segments[j][i];
                else
                    word += " ";
            }
            words.Add(word);
        }
        return string.Join(" ", words);
    }
}
